var windrose={degreesInCircle:360,directions8:["N","NE","E","SE","S","SW","W","NW"],directions16:["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"],getDirections:function(e){directions=[];for(key in e){if(key!=="calm"){directions.push(key)}}return directions},config:{"0-10":{fill:"#FFFF99"},"10-20":{fill:"#FFFF33"},"20-30":{fill:"#FFCC00"},">30":{fill:"#FF9900"}},angles:function(e){var t=e.length;var n=-.5;var r={};for(var i in e){r[e[i]]={start:windrose.degreesInCircle/t*n,end:windrose.degreesInCircle/t*++n}}return r},numberOfDirectionsInData:function(e){var t=0;for(key in e){t++}return t},maxLength:function(e){function n(e){if(e>t){t=e}}var t=0;var r=0;var i=0;for(var s in e){if(s==="calm"){r=e[s]}else{i=0;for(var o in e[s]){i+=e[s][o]}}n(i+r)}return t},domain:function(e){return Math.ceil(windrose.maxLength(e)/10)*10},drawFrequencyCircles:function(e,t,n){for(var r=e;r>=5;r-=10){n.append("circle").attr("cx",t.x).attr("cy",t.y).attr("r",r).style("fill","white").style("stroke","black").style("stroke-dasharray","5,5")}},drawChunk:function(e,t,n,r,i,s,o){var u=d3.svg.arc().innerRadius(r).outerRadius(r+n).startAngle(windrose.rad(s[e].start)).endAngle(windrose.rad(s[e].end));o.append("path").attr("d",u).attr("fill",windrose.config[t]["fill"]).attr("fill-opacity",.5).style("stroke","black").attr("transform","translate("+i.x+","+i.y+")").append("title").text(""+e+" "+t+" m/s "+n+"%");return r+n},drawRose:function(e,t,n){e=typeof e!=="undefined"?e:{calm:8,N:{"0-10":3,"10-20":12,"20-30":0,">30":0},NNE:{"0-10":4,"10-20":9,"20-30":2,">30":0},NE:{"0-10":0,"10-20":20,"20-30":0,">30":0},ENE:{"0-10":0,"10-20":2,"20-30":0,">30":0},E:{"0-10":0,"10-20":5,"20-30":0,">30":0},ESE:{"0-10":0,"10-20":5,"20-30":0,">30":0},SE:{"0-10":0,"10-20":0,"20-30":0,">30":0},SSE:{"0-10":0,"10-20":0,"20-30":0,">30":0},S:{"0-10":20,"10-20":30,"20-30":10,">30":10},SSW:{"0-10":23,"10-20":0,"20-30":0,">30":0},SW:{"0-10":23,"10-20":0,"20-30":0,">30":0},WSW:{"0-10":0,"10-20":11,"20-30":0,">30":0},W:{"0-10":0,"10-20":11,"20-30":0,">30":0},WNW:{"0-10":0,"10-20":11,"20-30":0,">30":0},NW:{"0-10":0,"10-20":0,"20-30":0,">30":0},NNW:{"0-10":0,"10-20":0,"20-30":0,">30":0}};t=typeof t!=="undefined"?t:{x:100,y:80};n=typeof n!=="undefined"?n:d3.select("body").append("svg").attr("width",300).attr("height",300);windrose.drawFrequencyCircles(windrose.domain(e),t,n);var r=windrose.getDirections(e);var i=windrose.angles(r);for(var s in e){if(s!=="calm"){var o=e["calm"];for(var u in e[s]){console.log(s+","+u+","+e[s][u]+","+o+","+t);o=windrose.drawChunk(s,u,e[s][u],o,t,i,n)}}}},bomStyle:{config:{"0-10":{fill:"#FFFF99",width:4},"10-20":{fill:"#FFFF33",width:8},"20-30":{fill:"#FFCC00",width:12},">30":{fill:"#FF9900",width:16}},drawRadiiCircles:function(e,t,n){for(var r=e;r>=20;r-=20){n.append("circle").attr("cx",t.x).attr("cy",t.y).attr("r",r).style("fill","white").style("stroke","black")}},drawCalmCircle:function(e,t,n){n.append("circle").attr("cx",t.x).attr("cy",t.y).attr("r",e).style("fill","white").style("stroke","black").append("title").text("Calm: "+e+"%")},drawRose:function(e,t,n){e=typeof e!=="undefined"?e:{calm:8,N:{"0-10":10,"10-20":10,"20-30":10,">30":10},NE:{"0-10":10,"10-20":10,"20-30":10,">30":10},E:{"0-10":10,"10-20":10,"20-30":10,">30":10},SE:{"0-10":10,"10-20":10,"20-30":10,">30":10},S:{"0-10":20,"10-20":30,"20-30":10,">30":10},SW:{"0-10":10,"10-20":10,"20-30":10,">30":10},W:{"0-10":10,"10-20":10,"20-30":10,">30":10},NW:{"0-10":10,"10-20":10,"20-30":10,">30":10}};t=typeof t!=="undefined"?t:{x:100,y:80};n=typeof n!=="undefined"?n:d3.select("body").append("svg").attr("width",300).attr("height",300);windrose.bomStyle.drawRadiiCircles(windrose.domain(e),t,n);windrose.bomStyle.drawCalmCircle(e["calm"],t,n);var r={N:180,NE:-90-45,E:-90,SE:-45,S:0,SW:45,W:90,NW:90+45};var i=t.y+e["calm"];for(var s in e){var o=i;if(s!=="calm"){for(var u in e[s]){var a="rotate("+r[s]+" "+t.x+" "+t.y+")";rect=n.append("rect").attr("x",t.x-windrose.bomStyle.config[u]["width"]/2).attr("y",o).attr("width",windrose.bomStyle.config[u]["width"]).attr("height",e[s][u]).attr("transform",a).style("fill",windrose.bomStyle.config[u]["fill"]).style("stroke","black").append("title").text("Direction: "+s+" Wind speed bin: "+u+" km/h Frequency: "+e[s][u]+"%");o+=e[s][u]}}}}},meanDirectional:{drawSpeedCircles:function(e,t){for(var n=80;n>=5;n-=10){e.append("circle").attr("cx",t.x).attr("cy",t.y).attr("r",n).style("fill","white").style("stroke","black").style("stroke-dasharray","5,5")}},drawSpeedSlice:function(e,t,n,r,i){var s=d3.svg.arc().innerRadius(0).outerRadius(r).startAngle(windrose.rad(i[n].start)).endAngle(windrose.rad(i[n].end));e.append("path").attr("d",s).attr("fill","green").attr("fill-opacity",.5).style("stroke","black").attr("transform","translate("+t.x+","+t.y+")").append("title").text(""+n+" average wind speed is "+r+"m/s")},drawRose:function(e,t,n){e=typeof e!=="undefined"?e:{N:10,NE:20,E:30,SE:40,S:50,SW:60,W:70,NW:80};t=typeof t!=="undefined"?t:{x:100,y:80};n=typeof n!=="undefined"?n:d3.select("body").append("svg").attr("width",300).attr("height",300);var r=windrose.getDirections(e);var i=windrose.angles(r);windrose.meanDirectional.drawSpeedCircles(n,t);for(var s in e){windrose.meanDirectional.drawSpeedSlice(n,t,s,e[s],i)}}},rad:function(e){return e*(Math.PI/180)}}